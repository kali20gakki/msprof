#!/usr/bin/env python
# coding=utf-8
"""
function:
Copyright Huawei Technologies Co., Ltd. 2021. All rights reserved.
"""
import os
import shutil
import unittest

from framework.offset_calculator import FileCalculator

NAMESPACE = 'framework.file_dispatch'


class TestFileCalculator(unittest.TestCase):
    HWTS_LOG_SIZE = 64
    FILE_0 = 'hwts.data.0.slice_0'
    FILE_1 = 'hwts.data.0.slice_1'

    def setup_class(self):
        self.current_path = "./file_calculator_test/"
        self.file_folder = "data/"
        self.file_dict = {
            self.FILE_0:b'\xc0\x00\xd3k\x00\x00\x02\x00\xed\xb9^I\xdc\x06\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd1\x00\xd3k\x00\x00\x02\x00/\xbe^I\xdc\x06\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe0\x00\xd3k\x00\x00\x03\x00\xb5\x04_I\xdc\x06\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xf1\x00\xd3k\x00\x00\x03\x00s\x06_I\xdc\x06\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xd3k\x00\x00\x04\x00I?_I\xdc\x06\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x11\x00\xd3k\x00\x00\x04\x00\xdd@_I\xdc\x06\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00 \x00\xd3k\x00\x00\x05\x00\xc6z_I\xdc\x06\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x001\x00\xd3k\x00\x00\x05\x00\x87|_I\xdc\x06\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00',
            self.FILE_1:b'@\x00\xd3k\x00\x00\x03\x00wn\x7f]\xdc\x06\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00Q\x00\xd3k\x00\x00\x03\x00\x94t\x7f]\xdc\x06\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
        }

        if not os.path.exists(self.current_path):
            os.mkdir(self.current_path)
        if not os.path.exists(self.current_path + self.file_folder):
            os.mkdir(self.current_path + self.file_folder)

        for file_name, file_content in self.file_dict.items():
            with open(self.current_path + self.file_folder + file_name, 'wb') as _file_writer:
                _file_writer.write(file_content)

    def teardown_class(self):
        if os.path.exists(self.current_path):
            shutil.rmtree(self.current_path)

    def test_prepare_process_0(self):
        expect_res = 512
        offset_count = 0
        total_count = 8
        file_calculator = FileCalculator([self.FILE_0, self.FILE_1], self.HWTS_LOG_SIZE, self.current_path,
                                         offset_count, total_count)
        binary_data = file_calculator.prepare_process()
        self.assertEqual(expect_res, len(binary_data))

    def test_prepare_process_1(self):
        expect_res = 128
        offset_count = 0
        total_count = 2
        file_calculator = FileCalculator([self.FILE_0, self.FILE_1], self.HWTS_LOG_SIZE, self.current_path,
                                         offset_count, total_count)
        binary_data = file_calculator.prepare_process()
        self.assertEqual(expect_res, len(binary_data))

